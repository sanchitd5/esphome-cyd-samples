font: !include
  file: fonts/fonts.yaml
  vars:
    text_sm: 14
    text_md: 18
    text_lg: 22
    text_xl: 26
    text_xxl: 30
    icons_sm: 18
    icons_md: 24
    icons_lg: 32
    icons_xl: 40
    icons_xxl: 48

.sizing:
  - &nav_widget_vars
    height: 40
    padding: 4

  - &page_styles
    <<: !include styles/page_styles.yaml
    pad_top: 40
    pad_bottom: 0

  - &container_styles
    <<: !include styles/container_styles.yaml
    pad_left: 4
    pad_right: 4
    scrollable: false # prevents scrollbars on pages where space is used up to the last pixel

  - &button_layout
    <<: !include styles/button_layout.yaml
    pad_column: 4
    pad_row: 5

  - &button_widget_vars
    width: 114
    height: 135

  - &wide_button_widget_vars
    width: 232
    height: 75

script:
  - id: go_home
    then:
      - lvgl.page.show: ${home_page}

lvgl:
  default_font: roboto_md
  theme: !include themes/main.yaml
  on_idle:
    timeout: !lambda "return (id(display_timeout).state * 1000);"
    then:
      - logger.log: "LVGL is idle"
      - light.turn_off: backlight
      - lvgl.pause:
  top_layer:
    widgets:
      - <<:
          !include {
            file: widgets/header/widget.yaml,
            vars: { <<: *nav_widget_vars },
          }
      - <<: !include { file: widgets/boot_screen/widget.yaml }
      - spinner:
          id: loading_spinner
          hidden: !lambda return (0 != id(door_status).state.compare(std::string{"opened"}) || 0 != id(door_status).state.compare(std::string{"closed"}));
          width: 50
          height: 50
          align: CENTER
          spin_time: 1s
          arc_length: 60deg
          arc_width: 16
          indicator:
            arc_color: 0x080888
            arc_width: 16
  pages:
    - id: splash
      skip: true
      on_load:
        - script.execute: go_home

    - id: garage
      <<: *page_styles
      on_load:
        - lvgl.label.update:
            id: page_title
            text: Garage
      widgets:
        - obj:
            <<: *container_styles
            layout:
              <<: *button_layout
            widgets:
              # Toggle Light (stateful)
              - button:
                  id: lamp_btn
                  checkable: true
                  <<: *button_widget_vars
                  on_click:
                    - homeassistant.action:
                        action: light.toggle
                        data:
                          entity_id: light.lamp
                  widgets:
                    - label:
                        id: lamp_icon
                        align: CENTER
                        text_font: mdi_xxl
                        text: "\U000F0336" # mdi-lightbulb-outline
                    - label:
                        align: BOTTOM_MID
                        text: "Light"

              # Garage Door Status (stateful button)
              - button:
                  id: garage_door_btn
                  clickable: !lambda return (0 == id(door_status).state.compare(std::string{"opened"}) || 0 == id(door_status).state.compare(std::string{"closed"}));
                  <<: *button_widget_vars
                  on_click:
                    - homeassistant.action:
                        action: input_button.press
                        data:
                          entity_id: input_button.toggle_garage_door
                    - logger.log: "Garage door button clicked"
                  widgets:
                    - label:
                        id: garage_door_state
                        align: TOP_MID
                        text: !lambda return (id(door_status).state);
                    - label:
                        id: garage_door_icon
                        align: CENTER
                        text_font: mdi_xxl
                        text: !lambda |-
                          if(0 == id(door_status).state.compare(std::string{"opened"}) || (0 == id(door_status).state.compare(std::string{"open"})) ) {
                            return "\U000F12D4"; // mdi:garage-open
                          } else if(0 == id(door_status).state.compare(std::string{"closing"}) || (0 == id(door_status).state.compare(std::string{"opening"})) ) {
                            return "\U000F0872"; // mdi:garage-alert
                          } else {
                            return "\U000F06D9"; // mdi:garage
                          }
                    - label:
                        align: BOTTOM_MID
                        text: "Garage Door"

              # Garage Indoor Door Status (stateful)
              - button:
                  id: indoor_door_status
                  checkable: false
                  <<: *button_widget_vars
                  widgets:
                    - label:
                        align: CENTER
                        text: "Indoor\nDoor"

              # Garage Backyard Door Status (stateful)
              - button:
                  id: backyard_door_status
                  checkable: false
                  <<: *button_widget_vars
                  widgets:
                    - label:
                        align: CENTER
                        text: "Backyard\nDoor"

packages:
  # header
  header_sensors: !include { file: widgets/header/sensors.yaml }

  # boot screen
  boot_screen_sensors: !include { file: widgets/boot_screen/sensors.yaml }

  # garage page sensors
  garage_sensors: !include { file: ../widgets/garage/sensors.yaml }
